<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Refuerzos Académicos</title>
    <script src="https://code.iconify.design/2/2.0.0-rc.3/iconify.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: white;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: #07376c;
            color: white;
            padding: 12px 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .left-section {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .menu-icon {
            font-size: 26px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .menu-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .header-title {
            font-weight: bold;
            font-size: 20px;
            letter-spacing: 0.5px;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            font-size: 16px;
        }

        main {
            flex: 1;
            padding: 30px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            overflow-y: auto;
            flex-direction: column;
            align-items: center;
        }

        .card {
            width: 200px;
            height: 280px;
            border-radius: 14px;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            color: white;
        }

        /* Colores para los headers según materia */
        .header-rojo {
            background: linear-gradient(135deg, #f44336, #e53935);
        }

        .header-amarillo {
            background: linear-gradient(135deg, #ffeb3b, #fbc02d);
            color: #333;
        }

        .header-verde {
            background: linear-gradient(135deg, #4caf50, #43a047);
        }

        .header-azul {
            background: linear-gradient(135deg, #07376c, #07376c);
            color: white;
        }

        .header-naranja {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .header-morado {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2);
        }

        .header-cian {
            background: linear-gradient(135deg, #00bcd4, #0097a7);
        }

        .card-content {
            flex: 1;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            font-size: 13px;
            color: #444;
        }

        .card-content p {
            margin: 6px 0;
            text-align: justify;
            align-items: justify;
        }

        .card-buttons {
            display: flex;
            gap: 6px;
            justify-content: center;
            padding: 8px;
            background-color: #f0f4ff;
            border-top: 1px solid #e0e0e0;
        }

        .card-buttons button {
            flex: 1 1 80px;
            background-color: #07376c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .card-buttons button:hover {
            background-color: #07376c;
        }

        /* Drawer y Modal */
        #drawer {
            position: fixed;
            top: 0;
            left: -260px;
            width: 260px;
            height: 100%;
            background-color: #07376c;
            padding: 50px 20px 30px;
            box-shadow: 4px 0 6px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .drawer-item {
            font-size: 18px;
            padding: 15px 0;
            border-bottom: 1px solid #A7C7E7;
            color: #2F4F6E;
            cursor: pointer;
            font-weight: 500;
        }

        .logout {
            color: #C62828;
            border-bottom-color: #C62828;
        }

        #drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }

        #drawer-overlay.show {
            display: block;
        }

        #drawer.show {
            left: 0;
        }

        /* Contenedor para generated */
        #generated-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        #generated-container h2 {
            color: #07376c;
            margin-bottom: 15px;
            align-items: center;
            text-align: center;
        }

        #generated-container a {
            color: #07376c;
            text-decoration: none;
        }

        #generated-container a:hover {
            text-decoration: underline;
        }

        #generated-container ul {
            list-style: inside disc;
            padding-left: 0;
            margin-bottom: 20px;
        }

        #generated-container ol {
            padding-left: 20px;
            margin-bottom: 20px;
        }

        /* Iconos para tipos de archivo */
        .material-icon-theme--pdf {
            display: inline-block;
            width: 90px;
            height: 90px;
            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ef5350' d='M13 9h5.5L13 3.5zM6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m4.93 10.44c.41.9.93 1.64 1.53 2.15l.41.32c-.87.16-2.07.44-3.34.93l-.11.04l.5-1.04c.45-.87.78-1.66 1.01-2.4m6.48 3.81c.18-.18.27-.41.28-.66c.03-.2-.02-.39-.12-.55c-.29-.47-1.04-.69-2.28-.69l-1.29.07l-.87-.58c-.63-.52-1.2-1.43-1.6-2.56l.04-.14c.33-1.33.64-2.94-.02-3.6a.85.85 0 0 0-.61-.24h-.24c-.37 0-.7.39-.79.77c-.37 1.33-.15 2.06.22 3.27v.01c-.25.88-.57 1.9-1.08 2.93l-.96 1.8l-.89.49c-1.2.75-1.77 1.59-1.88 2.12c-.04.19-.02.36.05.54l.03.05l.48.31l.44.11c.81 0 1.73-.95 2.97-3.07l.18-.07c1.03-.33 2.31-.56 4.03-.75c1.03.51 2.24.74 3 .74c.44 0 .74-.11.91-.3m-.41-.71l.09.11c-.01.1-.04.11-.09.13h-.04l-.19.02c-.46 0-1.17-.19-1.9-.51c.09-.1.13-.1.23-.1c1.4 0 1.8.25 1.9.35M7.83 17c-.65 1.19-1.24 1.85-1.69 2c.05-.38.5-1.04 1.21-1.69zm3.02-6.91c-.23-.9-.24-1.63-.07-2.05l.07-.12l.15.05c.17.24.19.56.09 1.1l-.03.16l-.16.82z'/%3E%3C/svg%3E");
        }

        .vscode-icons--file-type-word {
            display: inline-block;
            width: 90px;
            height: 90px;
            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='vscodeIconsFileTypeWord0' x1='4.494' x2='13.832' y1='-1712.086' y2='-1695.914' gradientTransform='translate(0 1720)' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%232368c4'/%3E%3Cstop offset='.5' stop-color='%231a5dbe'/%3E%3Cstop offset='1' stop-color='%231146ac'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='%2341a5ee' d='M28.806 3H9.705a1.19 1.19 0 0 0-1.193 1.191V9.5l11.069 3.25L30 9.5V4.191A1.19 1.19 0 0 0 28.806 3'/%3E%3Cpath fill='%232b7cd3' d='M30 9.5H8.512V16l11.069 1.95L30 16Z'/%3E%3Cpath fill='%23185abd' d='M8.512 16v6.5l10.418 1.3L30 22.5V16Z'/%3E%3Cpath fill='%23103f91' d='M9.705 29h19.1A1.19 1.19 0 0 0 30 27.809V22.5H8.512v5.309A1.19 1.19 0 0 0 9.705 29'/%3E%3Cpath d='M16.434 8.2H8.512v16.25h7.922a1.2 1.2 0 0 0 1.194-1.191V9.391A1.2 1.2 0 0 0 16.434 8.2' opacity='0.1'/%3E%3Cpath d='M15.783 8.85H8.512V25.1h7.271a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191' opacity='0.2'/%3E%3Cpath d='M15.783 8.85H8.512V23.8h7.271a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191' opacity='0.2'/%3E%3Cpath d='M15.132 8.85h-6.62V23.8h6.62a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191' opacity='0.2'/%3E%3Cpath fill='url(%23vscodeIconsFileTypeWord0)' d='M3.194 8.85h11.938a1.193 1.193 0 0 1 1.194 1.191v11.918a1.193 1.193 0 0 1-1.194 1.191H3.194A1.19 1.19 0 0 1 2 21.959V10.041A1.19 1.19 0 0 1 3.194 8.85'/%3E%3Cpath fill='%23fff' d='M6.9 17.988q.035.276.046.481h.028q.015-.195.065-.47c.05-.275.062-.338.089-.465l1.255-5.407h1.624l1.3 5.326a8 8 0 0 1 .162 1h.022a8 8 0 0 1 .135-.975l1.039-5.358h1.477l-1.824 7.748h-1.727l-1.237-5.126q-.054-.222-.122-.578t-.084-.52h-.021q-.021.189-.084.561t-.1.552L7.78 19.871H6.024L4.19 12.127h1.5l1.131 5.418a5 5 0 0 1 .079.443'/%3E%3C/svg%3E");
        }

        .vscode-icons--file-type-excel2 {
            display: inline-block;
            width: 90px;
            height: 90px;
            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%2320744a' fill-rule='evenodd' d='M28.781 4.405h-10.13V2.018L2 4.588v22.527l16.651 2.868v-3.538h10.13A1.16 1.16 0 0 0 30 25.349V5.5a1.16 1.16 0 0 0-1.219-1.095m.16 21.126H18.617l-.017-1.889h2.487v-2.2h-2.506l-.012-1.3h2.518v-2.2H18.55l-.012-1.3h2.549v-2.2H18.53v-1.3h2.557v-2.2H18.53v-1.3h2.557v-2.2H18.53v-2h10.411Z'/%3E%3Cpath fill='%2320744a' d='M22.487 7.439h4.323v2.2h-4.323zm0 3.501h4.323v2.2h-4.323zm0 3.501h4.323v2.2h-4.323zm0 3.501h4.323v2.2h-4.323zm0 3.501h4.323v2.2h-4.323z'/%3E%3Cpath fill='%23fff' fill-rule='evenodd' d='m6.347 10.673l2.146-.123l1.349 3.709l1.594-3.862l2.146-.123l-2.606 5.266l2.606 5.279l-2.269-.153l-1.532-4.024l-1.533 3.871l-2.085-.184l2.422-4.663z'/%3E%3C/svg%3E");
        }

        .logos--youtube-icon {
            display: inline-block;
            width: 105px;
            height: 70px;
            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 180'%3E%3Cpath fill='%23f00' d='M250.346 28.075A32.18 32.18 0 0 0 227.69 5.418C207.824 0 127.87 0 127.87 0S47.912.164 28.046 5.582A32.18 32.18 0 0 0 5.39 28.24c-6.009 35.298-8.34 89.084.165 122.97a32.18 32.18 0 0 0 22.656 22.657c19.866 5.418 99.822 5.418 99.822 5.418s79.955 0 99.82-5.418a32.18 32.18 0 0 0 22.657-22.657c6.338-35.348 8.291-89.1-.164-123.134'/%3E%3Cpath fill='%23fff' d='m102.421 128.06l66.328-38.418l-66.328-38.418z'/%3E%3C/svg%3E");
        }

        .flat-color-icons--audio-file {
            display: inline-block;
            width: 90px;
            height: 90px;
            background-repeat: no-repeat;
            background-size: 100% 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='none' d='M204 0h48v48h-48z'/%3E%3Cpath fill='%2390caf9' d='M244 45h-32V3h22l10 10z'/%3E%3Cpath fill='%23e1f5fe' d='M242.5 14H233V4.5z'/%3E%3Cg fill='%231976d2'%3E%3Ccircle cx='227' cy='30' r='4'/%3E%3Cpath d='m234 21l-5-2v11h2v-7.1l3 1.1z'/%3E%3C/g%3E%3Cpath fill='%2390caf9' d='M40 45H8V3h22l10 10z'/%3E%3Cpath fill='%23e1f5fe' d='M38.5 14H29V4.5z'/%3E%3Cg fill='%231976d2'%3E%3Ccircle cx='23' cy='30' r='4'/%3E%3Cpath d='m30 21l-5-2v11h2v-7.1l3 1.1z'/%3E%3C/g%3E%3C/svg%3E");
        }

        .lets-icons--img-box-fill {
            display: inline-block;
            width: 90px;
            height: 90px;
            --svg: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cg fill='none'%3E%3Cpath fill='%23000' fill-rule='evenodd' d='M3.172 3.172C2 4.343 2 6.229 2 10v4c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4c3.771 0 5.657 0 6.828-1.172S22 17.771 22 14v-4c0-2.84 0-4.61-.5-5.811V17a3.62 3.62 0 0 1-2.56-1.06l-.752-.752c-.722-.722-1.082-1.082-1.491-1.234a2 2 0 0 0-1.394 0c-.409.152-.77.512-1.49 1.234l-.114.113c-.585.585-.878.878-1.189.932a1 1 0 0 1-.699-.134c-.268-.166-.431-.547-.758-1.308L11 14.667c-.75-1.75-1.124-2.624-1.778-2.952a2 2 0 0 0-1.065-.205c-.729.062-1.401.735-2.747 2.08L3.5 15.5V2.887q-.174.129-.328.285' clip-rule='evenodd'/%3E%3Cpath stroke='%23000' stroke-width='2' d='M3 10c0-1.914.002-3.249.138-4.256c.131-.978.372-1.496.74-1.865c.37-.37.888-.61 1.866-.741C6.751 3.002 8.086 3 10 3h4c1.914 0 3.249.002 4.256.138c.978.131 1.496.372 1.865.74c.37.37.61.888.742 1.866C20.998 6.751 21 8.086 21 10v4c0 1.914-.002 3.249-.137 4.256c-.132.978-.373 1.496-.742 1.865c-.369.37-.887.61-1.865.742c-1.007.135-2.342.137-4.256.137h-4c-1.914 0-3.249-.002-4.256-.137c-.978-.132-1.496-.373-1.865-.742c-.37-.369-.61-.887-.741-1.865C3.002 17.249 3 15.914 3 14z'/%3E%3Ccircle cx='15' cy='9' r='2' fill='%23000'/%3E%3C/g%3E%3C/svg%3E");
            background-color: currentColor;
            -webkit-mask-image: var(--svg);
            mask-image: var(--svg);
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-size: 100% 100%;
            mask-size: 100% 100%;
        }

        /* ==================== NUEVO ESTILO CARRUSEL ==================== */
        #carousel-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        #carousel-step {
            min-width: 280px;
            max-width: 400px;
            padding: 20px 25px;
            background: linear-gradient(145deg, #f0f5ff, #d9e4ff);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(70, 130, 250, 0.15);
            font-size: 16px;
            font-weight: 500;
            color: #1a237e;
            text-align: left;
            transition: opacity 0.3s ease-in-out;
            position: relative;
            min-height: 100px;
            line-height: 1.5;
        }

        .carousel-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .carousel-button {
            background-color: #3f51b5;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(63, 81, 181, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.25s ease, transform 0.15s ease;
            user-select: none;
        }

        .carousel-button:hover:not(:disabled) {
            background-color: #303f9f;
            transform: scale(1.1);
        }

        .carousel-button:disabled {
            background-color: #9fa8da;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* Indicadores tipo puntos */
        #carousel-indicators {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 8px;
        }

        .carousel-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #c5cae9;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .carousel-indicator.active {
            background-color: #3f51b5;
        }

        /* Responsive */
        @media (max-width: 520px) {
            #carousel-container {
                gap: 10px;
            }

            #carousel-step {
                min-width: 90vw;
                max-width: 90vw;
            }

            .carousel-buttons {
                flex-direction: row;
                gap: 10px;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="left-section">
            <button id="menu-btn" class="menu-icon">☰</button>
            <span class="header-title">Actividades</span>
        </div>
        <div class="user-section" id="user-section">
            <span>👤</span> <span id="nombre-usuario"></span>
        </div>
    </header>

    <div id="drawer-overlay"></div>
    <div id="drawer">
        <div>
            <div class="drawer-item" onclick="navigateTo('perfil.html')">👤 Perfil</div>
            <div class="drawer-item" onclick="navigateTo('home-alumno.html')">🏠 Materias</div>
        </div>
        <div class="drawer-item logout" onclick="logout()">📤 Cerrar sesión</div>
    </div>
    <!-- Contenedor donde mostraremos generated -->
    <section id="generated-container">
        <!-- contenido generado dinámicamente -->
    </section>

    <script>
        // Función para extraer userId del token JWT guardado
        function getUserIdFromToken(token) {
            if (!token) return null;
            try {
                const payload = token.split('.')[1];
                const decoded = atob(payload);
                const obj = JSON.parse(decoded);
                const userId = obj._id || obj.id || null;

                if (userId) {
                    localStorage.setItem('userId', userId);
                }

                return userId;
            } catch {
                return null;
            }
        }

        // Función para navegar entre páginas
        function navigateTo(path) {
            drawer.classList.remove('show');
            overlay.classList.remove('show');
            setTimeout(() => {
                window.location.href = path;
            }, 300);
        }

        // Función para cerrar sesión
        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }

        // Abrir link en nueva pestaña
        function openLink(url) {
            window.open(url, '_blank');
        }

        // Variables drawer, overlay y menuBtn
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('drawer-overlay');
        const menuBtn = document.getElementById('menu-btn');

        menuBtn.onclick = () => {
            drawer.classList.add('show');
            overlay.classList.add('show');
        };
        overlay.onclick = () => {
            drawer.classList.remove('show');
            overlay.classList.remove('show');
        };

        // Mostrar nombre usuario si está disponible
        function mostrarNombreUsuario() {
            const token = localStorage.getItem('accessToken');
            if (!token) return;
            try {
                const payload = token.split('.')[1];
                const decoded = atob(payload);
                const obj = JSON.parse(decoded);
                const nombre = obj.nombre || obj.name || '';
                if (nombre) {
                    document.getElementById('nombre-usuario').textContent = nombre;
                }
            } catch {
                // no hacer nada
            }
        }

        mostrarNombreUsuario();

        async function cargarRefuerzoPorUsuario(userId) {
            const token = localStorage.getItem('accessToken');
            if (!token || !userId) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const res = await fetch(`http://localhost:3000/academic-support/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!res.ok) throw new Error('Error al obtener datos');

                const data = await res.json();

                if (!data.topic || !data.subtopics || !Array.isArray(data.subtopics) || data.subtopics.length === 0) {
                    const container = document.getElementById('generated-container');
                    container.innerHTML = '<p>No hay subtemas disponibles.</p>';
                }

                // Cargar sección generated
                if (data.generated) {
                    mostrarGenerated(data.generated);
                }

            } catch (error) {
                console.error(error);
                alert('Error cargando subtemas.');
            }
        }

        // Función para mostrar la info de generated con iconos y carrusel mejorado
        function mostrarGenerated(generatedString) {
            let generatedObj;
            try {
                generatedObj = JSON.parse(generatedString);
            } catch (e) {
                console.error('Error parseando generated:', e);
                return;
            }
            const container = document.getElementById('generated-container');
            container.innerHTML = '';

            if (generatedObj.recursos_recomendados && generatedObj.recursos_recomendados.length > 0) {
                const recursosDiv = document.createElement('div');
                recursosDiv.innerHTML = `<h2>📘 Recursos Recomendados</h2>`;

                generatedObj.recursos_recomendados.forEach(recurso => {
                    const recursoElem = document.createElement('div');
                    recursoElem.style.marginBottom = '10px';
                    recursoElem.style.display = 'flex';
                    recursoElem.style.alignItems = 'center';
                    recursoElem.style.gap = '12px';

                    // Determinar clase icono según tipo
                    let iconClass = '';
                    const tipo = (recurso.tipo || '').toLowerCase();
                    if (tipo.includes('pdf')) iconClass = 'material-icon-theme--pdf';
                    else if (tipo.includes('word') || tipo.includes('doc')) iconClass = 'vscode-icons--file-type-word';
                    else if (tipo.includes('excel')) iconClass = 'vscode-icons--file-type-excel2';
                    else if (tipo.includes('video') || tipo.includes('mp4') || tipo.includes('youtube')) iconClass = 'logos--youtube-icon';
                    else if (tipo.includes('imagen') || tipo.includes('image') || tipo.includes('jpeg') || tipo.includes('jpg') || tipo.includes('png')) iconClass = 'lets-icons--img-box-fill';
                    else if (tipo.includes('audio')) iconClass = 'flat-color-icons--audio-file';
                    else iconClass = '';

                    const urlRecurso = recurso.dropbox_url || recurso.dropbuxUrl;

                    const iconSpan = document.createElement('span');
                    iconSpan.className = iconClass;
                    iconSpan.style.cursor = 'pointer';
                    if (urlRecurso) {
                        iconSpan.onclick = () => {
                            window.open(urlRecurso, '_blank');
                        };
                    }

                    const textDiv = document.createElement('div');
                    textDiv.innerHTML = `
        <strong>${recurso.titulo}</strong> (${recurso.tipo})<br/>
        <a href="${urlRecurso}" target="_blank" rel="noopener noreferrer">Abrir recurso</a>
    `;

                    recursoElem.appendChild(iconSpan);
                    recursoElem.appendChild(textDiv);

                    recursosDiv.appendChild(recursoElem);
                });

                container.appendChild(recursosDiv);
            }

            if (generatedObj.actividad_de_refuerzo) {
                const actividad = generatedObj.actividad_de_refuerzo;
                const actividadDiv = document.createElement('div');
                actividadDiv.style.marginTop = '30px';
                actividadDiv.innerHTML = `
                    <h2 style="color:#07376c; font-weight: 700;">📗 Actividad de Refuerzo</h2>
                    <h4><strong>Descripción general</strong></h4>
                    <p style="font-size: 15px; line-height: 1.6; color: #333;">${actividad.descripcion_general}</p>

                    <div id="carousel-container">
                        <button id="carousel-prev" class="carousel-button" aria-label="Anterior paso">&#8592;</button>

                        <div id="carousel-step" aria-live="polite" aria-atomic="true"></div>

                        <button id="carousel-next" class="carousel-button" aria-label="Siguiente paso">&#8594;</button>
                    </div>

                    <div id="carousel-indicators" role="tablist" aria-label="Indicadores de pasos"></div>
                `;
                container.appendChild(actividadDiv);

                const pasos = actividad.pasos || [];
                let current = 0;
                const stepDiv = document.getElementById('carousel-step');
                const prevBtn = document.getElementById('carousel-prev');
                const nextBtn = document.getElementById('carousel-next');
                const indicatorsContainer = document.getElementById('carousel-indicators');

                function renderStep() {
                    if (!pasos.length) {
                        stepDiv.textContent = 'No hay pasos disponibles.';
                        prevBtn.disabled = true;
                        nextBtn.disabled = true;
                        indicatorsContainer.style.display = 'none';
                        return;
                    }

                    // Animación suave de desvanecimiento
                    stepDiv.style.opacity = 0;
                    setTimeout(() => {
                        stepDiv.innerHTML = `<strong>Paso ${current + 1}:</strong> ${pasos[current]}`;
                        stepDiv.style.opacity = 1;
                    }, 200);

                    prevBtn.disabled = current === 0;
                    nextBtn.disabled = current === pasos.length - 1;

                    // Actualizar indicadores
                    indicatorsContainer.innerHTML = '';
                    pasos.forEach((_, i) => {
                        const dot = document.createElement('div');
                        dot.className = 'carousel-indicator' + (i === current ? ' active' : '');
                        dot.setAttribute('role', 'tab');
                        dot.setAttribute('aria-selected', i === current ? 'true' : 'false');
                        dot.setAttribute('tabindex', '0');
                        dot.addEventListener('click', () => {
                            current = i;
                            renderStep();
                        });
                        dot.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                current = i;
                                renderStep();
                            }
                        });
                        indicatorsContainer.appendChild(dot);
                    });
                }

                prevBtn.onclick = () => {
                    if (current > 0) {
                        current--;
                        renderStep();
                    }
                };
                nextBtn.onclick = () => {
                    if (current < pasos.length - 1) {
                        current++;
                        renderStep();
                    }
                };

                renderStep();
            }
        }

        // Inicio
        document.getElementById('user-section').onclick = () => {
            window.location.href = 'perfil.html';
        };
        const token = localStorage.getItem('accessToken');
        const userId = getUserIdFromToken(token);
        if (userId) {
            cargarRefuerzoPorUsuario(userId);
        }
    </script>

</body>

</html>
